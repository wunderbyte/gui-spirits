<!DOCTYPE html><html lang="en"><head><title>GUI Spirits</title><meta charset="UTF-8"><meta name="viewport" content="viewport-fit=cover,width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel="icon" type="image/gif" href="data:image/gif;base64,data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw"><link rel="stylesheet" href="index.css"><script type="module" src="index.js"></script></head><body class="index"><main><article><h1 id="gui-spirits" tabindex="-1">GUI Spirits</h1><p>A simple <a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components">web components</a> library.</p><p><strong>GUI Spirits</strong> offers no new things to do, but focuses instead on <em>how</em> you do it by providing an API based entirely on functions. Since no classes are involved, there is no <code>this</code> keyword to keep track of, no class hierarchy to maintain, no private or static methods, no decorators, just functions.</p><h2 id="installation" tabindex="-1">Installation</h2><p>This library is yet unpublished, so you'll need to copy the <code>src</code> folder into your project and boot it up with a <a href="https://blog.bitsrc.io/11-tools-to-build-a-monorepo-in-2021-7ce904821cc2">monorepo manager</a> since the folder contains multiple packages. Make sure to test in your oldest browser to see if you need Babel plugins or equivalent to support the syntax. There's an NPM script that can exports the files for you.</p><pre class="language-console"><code class="language-console">npm run export ../myproject/mylibs/
</code></pre><h2 id="components" tabindex="-1">Components</h2><p>The library exports a single function <code>summon</code> that will register a Custom Element with a <em>possessor function</em> to be invoked when the element is found in the DOM. The function recieves an object <code>spirit</code> with a property <code>element</code> that lets you handle the Custom Element.</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> summon <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@gui/spirits'</span><span class="token punctuation">;</span>
<span class="token function">summon</span><span class="token punctuation">(</span><span class="token string">'my-component'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">onpossess</span><span class="token punctuation">(</span><span class="token parameter">spirit</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  spirit<span class="token punctuation">.</span>element<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'inserted'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>The element can expose methods and properties. Note that the element must be document-connected before this interface becomes available.</p><pre class="language-js"><code class="language-js"><span class="token function">summon</span><span class="token punctuation">(</span><span class="token string">'my-component'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> element <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      element<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token string">'toggled'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">get</span> <span class="token function">toggled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> element<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'toggled'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>The Spirit also provides some basic <a href="#lifecycle">lifecycle hooks</a> and that's bascially all there is to it. You can enhance your workflow by collecting related functionality in a <em>plugin</em> and you might also want to take a look at some <a href="plugins/">reference plugins</a>.</p><h2 id="plugins" tabindex="-1">Plugins</h2><p>Let's create a simple plugin to maintain CSS classnames.</p><pre class="language-js"><code class="language-js"><span class="token comment">/**
 * @param {CustomElement} element
 */</span>
<span class="token keyword">function</span> <span class="token function">CSSPlugin</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>names</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      element<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">...</span>names<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token operator">...</span>names<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      element<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token operator">...</span>names<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">has</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> element<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>Plugins are simply functions that takes the element as an argument and returns an interface to operate on it. We'll register the plugin as a property of the Spirit by passing an iterable to the <code>summon</code> method. Let's assign it to the property name <code>css</code>.</p><pre class="language-js"><code class="language-js"><span class="token function">summon</span><span class="token punctuation">(</span><span class="token string">'my-component'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">spirit</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  spirit<span class="token punctuation">.</span>css<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'inserted'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// using the plugin!</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">'css'</span><span class="token punctuation">,</span> CSSPlugin<span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>This of course becomes tedious to set up whenever we create a new component, so we will assign our plugins once and for all and re-export the <code>summon</code> method with all the plugins baked in. Plugins are instantiated <a href="https://en.wikipedia.org/wiki/Lazy_initialization">lazily</a>, so we can register as many plugins as we like even if they are rarely used. Let'stry that with some <a href="plugins/">reference plugins</a>.</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> summon <span class="token keyword">as</span> oldsummon <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@gui/spirits'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> AttPlugin <span class="token keyword">from</span> <span class="token string">'@gui/plugin-att'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> CSSPlugin <span class="token keyword">from</span> <span class="token string">'@gui/plugin-css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> DOMPlugin <span class="token keyword">from</span> <span class="token string">'@gui/plugin-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> EventPlugin <span class="token keyword">from</span> <span class="token string">'@gui/plugin-event'</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @param {Function} possessor
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">summon</span><span class="token punctuation">(</span><span class="token parameter">possessor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">oldsummon</span><span class="token punctuation">(</span>possessor<span class="token punctuation">,</span>  <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">'att'</span><span class="token punctuation">,</span> AttPlugin<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// working with attributes</span>
    <span class="token punctuation">[</span><span class="token string">'css'</span><span class="token punctuation">,</span> CSSPlugin<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// working with classnames</span>
    <span class="token punctuation">[</span><span class="token string">'dom'</span><span class="token punctuation">,</span> DOMPlugin<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// working with the DOM</span>
    <span class="token punctuation">[</span><span class="token string">'event'</span><span class="token punctuation">,</span> EventPlugin<span class="token punctuation">]</span> <span class="token comment">// working with events</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>Once the file is saved, make sure to import your enhanced function from the new location.</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> summon <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./my-spirits'</span><span class="token punctuation">;</span>
<span class="token function">summon</span><span class="token punctuation">(</span><span class="token string">'my-component'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">spirit</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    spirit<span class="token punctuation">.</span>css<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'inserted'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>You can study the <a href="#plugin-guide">plugin authoring guide</a> before you create your first plugin, but let's first see how plugins can be used in real code.</p><h2 id="destructuring" tabindex="-1">Destructuring</h2><p>You can <a href="https://www.javascripttutorial.net/es6/javascript-object-destructuring/">destructure</a> the Spirit like any other object for a nice and compact syntax.</p><pre class="language-js"><code class="language-js"><span class="token function">summon</span><span class="token punctuation">(</span><span class="token string">'my-component'</span><span class="token punctuation">,</span> possess<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Destructuring plugins.
 * @param {Spirit} spirit
 */</span>
<span class="token keyword">function</span> <span class="token function">possess</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> att<span class="token punctuation">,</span> css<span class="token punctuation">,</span> dom<span class="token punctuation">,</span> event <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  att<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'my-attribute'</span><span class="token punctuation">,</span> <span class="token string">'my-value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  css<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'my-classname'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  dom<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'Click me!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  event<span class="token punctuation">.</span><span class="token function">onclick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Clicked!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>As features get added, you will eventually want to split this into multiple functions. To this purpose, the Spirit facilitates <em>recursive destructuring</em> via a property <code>spirit</code> that points to the Spirit itself. Simply forward this property to destructure the Spirit forever.</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> summon <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./my-spirits'</span><span class="token punctuation">;</span>

<span class="token function">summon</span><span class="token punctuation">(</span><span class="token string">'my-component'</span><span class="token punctuation">,</span> possess<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">possess</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> att<span class="token punctuation">,</span> spirit <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  att<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'my-attribute'</span><span class="token punctuation">,</span> <span class="token string">'my-value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">updateCSS</span><span class="token punctuation">(</span>spirit<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">updateCSS</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> css<span class="token punctuation">,</span> spirit <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  css<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'my-classname'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">updateDOM</span><span class="token punctuation">(</span>spirit<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">updateDOM</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> dom<span class="token punctuation">,</span> spirit <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  dom<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'Click me!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">updateEvents</span><span class="token punctuation">(</span>spirit<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">updateEvents</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> event <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">onclick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Clicked!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><p>Whenenver you create a new function, consider passing the whole Spirit instead of just a single plugin. This will let you keep all your plugins at hand when you need them later.</p><h2 id="lifecycle" tabindex="-1">Lifecycle</h2><p>Spirits never execute any code before the element is connected to page. This convention guarantees that we can safely measure the elements dimensions or access the <code>parentNode</code> without running into <code>0</code> or <code>null</code>. But this also means that we don't need a special callback to detect when insertion happens, the possessor function does that for us. The spirit however offers two methods to detect whenever the element gets <em>moved around</em> in the DOM.</p><pre class="language-js"><code class="language-js"><span class="token function">summon</span><span class="token punctuation">(</span><span class="token string">'my-component'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> ondetach<span class="token punctuation">,</span> onattach <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'first detected in the DOM'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ondetach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'removed'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">onattach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'inserted again'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>These methods both return a function to cancel the callback.</p><p>If the element is removed from the document structure and not re-inserted more or less immediately, the spirit will be permanently <em>exorcised</em>. At this point, it stops working altogether and attempts to address the spirit's plugins, properties or methods will lead to errors. The spirit offers to execute a callback just before this happen.</p><pre class="language-js"><code class="language-js"><span class="token function">summon</span><span class="token punctuation">(</span><span class="token string">'my-component'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> onexorcise <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> loop <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>myupdate<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">onexorcise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>loop<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="plugin-guide" tabindex="-1">Plugin guide</h2><p>TODO: Write short guide. Remember <code>this</code> keyword to support destructuring. Remember <code>onexorcise</code> method (and support <code>ondetach</code> and <code>onattach</code> in plugins). Also a note on inter-plugin communication and somehing about higher order functions.</p><blockquote><p>TODO: Also implement and document &quot;enterprise mode&quot; to obscure the occult terminology going on with spirits and possesion and what not.</p></blockquote></article><div class="cover" id="article-cover"></div></main><aside><ul><li><a href="">Introduction</a></li><li><a href="#installation">Installation</a></li><li><a href="#components">Components</a></li><li><a href="#plugins">Plugins</a></li><li><a href="#destructuring">Destructuring</a></li><li><a href="#lifecycle">Lifecycle</a></li><li><a href="plugins/">Reference plugins</a><ul><li><a href="plugins/css.html">CSSPlugin</a></li><li><a href="plugins/dom.html">DOMPlugin</a></li><li><a href="plugins/shadow.html">ShadowPlugin</a></li></ul></li></ul><div class="cover" id="cover"></div></aside></body></html>